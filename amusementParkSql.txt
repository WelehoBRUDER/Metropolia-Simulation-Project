DROP DATABASE IF EXISTS amusement_park;
CREATE DATABASE amusement_park;
USE amusement_park;

CREATE TABLE simulation (
	sim_id INT NOT NULL AUTO_INCREMENT,
	time_stamp BIGINT,
	PRIMARY KEY (sim_id)
);

CREATE TABLE service_point (
	sim_id INT NOT NULL,
	simulation_time DECIMAL(12, 2),
	ready_customers INT,
	ticket_customers INT,
	wristband_customers INT,
	unready_customers INT,
	ticket_booth_average DECIMAL(12, 2),
	total_ticket_count INT,
	wristband_average_time DECIMAL(12, 2),
	ticket_average_time DECIMAL(12,2),
	whole_average_time DECIMAL(12, 2),
	ticket_wristband_time_ratio DECIMAL(12, 2),
	#PRIMARY KEY (sim_id),
	FOREIGN KEY (sim_id) REFERENCES simulation(sim_id) ON DELETE CASCADE
);

CREATE TABLE ride (
	sim_id INT NOT NULL,
	ride_id INT NOT NULL,
	count INT,
	average_service_time DECIMAL(12, 2),
	average_queue_time DECIMAL(12, 2),
	variance DECIMAL(12, 2),
	mean DECIMAL(12,2),
	#PRIMARY KEY (ride_id),
	FOREIGN KEY (sim_id) REFERENCES simulation(sim_id) ON DELETE CASCADE
);

CREATE TABLE ticket_booth (
	sim_id INT NOT NULL,
	ticket_booth_id INT,
	count INT,
	average_service_time DECIMAL(12, 2),
	average_queue_time DECIMAL(12, 2),
	#PRIMARY KEY (sim_id),
	FOREIGN KEY (sim_id) REFERENCES simulation(sim_id) ON DELETE CASCADE
);

CREATE TABLE restaurant (
	sim_id INT NOT NULL,
	count INT,
	average_service_time DECIMAL(12, 2),
	average_queue_time DECIMAL(12, 2),
	capacity INT,
	#PRIMARY KEY (sim_id),
	FOREIGN KEY (sim_id) REFERENCES simulation(sim_id) ON DELETE CASCADE
);
/*
INSERT INTO simulation (sim_id) VALUES (NULL);
INSERT INTO rides (sim_id, customer_amount, average_serve_time, average_wait_time) VALUES
	(LAST_INSERT_ID(), 5, 5, 5);
INSERT INTO rides (sim_id, customer_amount, average_serve_time, average_wait_time) VALUES
	(LAST_INSERT_ID(), 52, 52, 25);
*/

/*
#INSERT INTO simulation DEFAULT VALUES;
INSERT INTO simulation (id) VALUES (NULL);

INSERT INTO restaurant (id, customer_amount, average_serve_time, average_wait_time) VALUES
	(LAST_INSERT_ID(), 5, 5, 5);
	
INSERT INTO service_point (id, customer_amount, average_serve_time, average_wait_time) VALUES
	(LAST_INSERT_ID(), 5, 5, 5);
	
	
	
INSERT INTO simulation (id) VALUES (NULL);
	
INSERT INTO service_point (id, customer_amount, average_serve_time, average_wait_time) VALUES
	(LAST_INSERT_ID(), 57, 57, 57);
	
	
	
	
INSERT INTO simulation (id) VALUES (NULL);

INSERT INTO restaurant (id, customer_amount, average_serve_time, average_wait_time) VALUES
	(LAST_INSERT_ID(), 25, 25, 25);
	
INSERT INTO service_point (id, customer_amount, average_serve_time, average_wait_time) VALUES
	(LAST_INSERT_ID(), 15, 15, 51);
	
*/


DROP USER IF EXISTS 'amusement'@'localhost';
CREATE USER 'amusement'@'localhost' IDENTIFIED BY 'password';
GRANT SELECT, INSERT, UPDATE, DELETE ON amusement_park.* TO 'amusement'@'localhost';